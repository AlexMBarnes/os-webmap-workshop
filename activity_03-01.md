#Part 3, Activity 1
##Make an interactive choropleth map

###Introduction
In this activity you'll be using CartoCSS and TileMill to make a choropleth map of the Hungarian descended population in Lucas County Ohio by census tract. Your map will also include a legend and interactivity that informs a visitor to your map about the total and percentage of the Hungarian descended population. At the end you will export your map to mbtiles and upload it to Mapbox.

###What you will need
- [TileMill](https://www.mapbox.com/tilemill/)
- [Mapbox account](https://www.mapbox.com/signup/) (the free plan will be sufficient)
- Census tract level data for Lucas County, OH on Hungarian ancestry. (If you cloned the os-webmap-workshop repo you can find i your local copy at **/data/prepared/lucasCo_hungarian_tracts.geojson**. Otherwise, you get it [here](https://raw.githubusercontent.com/maptastik/os-webmap-workshop/gh-pages/data/prepared/lucasCo_hungarian_tracts.geojson))

###Let's make a map!
1. Open TileMill
2. You'll see the *Projects* window. Click  **+ New Project**<br /><img src="https://maptastik.github.com/os-webmap-workshop/images/tm-projects1.png" width=50% />
3. You should see the *New project* window. Fill out the **Filename** field. Also uncheck **Default data**. We don't need the world layers that TileMill provides. Still, it's good to know they're there! If you want to fill in **Name** or **Description** fields you may, but it's not necessary. When you're finished, click **Add**.<br /><img src="https://maptastik.github.com/os-webmap-workshop/images/tm-projects2.png" width=50% />
4. In the *Projects* window, select the project you just made.
5. TileMill will open up your project. It has by default added a light blue background to your project. That's not a layer of data! It's just a style for the space you'll be putting your data into!<br /><img src="https://maptastik.github.com/os-webmap-workshop/images/tm-map1.png" width=50% />
6. Go ahead and just delete the default CartoCSS:<br/>`Map {
  background-color: #b8dee6;
}`
7. You should see a gridded background. That means you have no actual background anymore. That's good! It will allow us to eventually add our map on top of other maps.
8. Let's add our data. In the bottom-left corner of your window you should see a vertical stack of four buttons. Each one opens up a lot of TileMill's functionality, but we're most concerned with getting our data into TileMill. As such, click the bottom-most button.<br /><img src="https://maptastik.github.com/os-webmap-workshop/images/tm-map2.PNG" width=10%/>
9. This will open up a little *Layers* window. Since we haven't added anything to our project, there aren't any layers shown. Let's change that! Click **+ Add Layer** <br /><img src="https://maptastik.github.com/os-webmap-workshop/images/tm-map3.PNG" width=100% />
10. You should see the *Add Layer* window. Fill in the **ID** field with a short name for the layer. You can name it whatever you want, but it's helpful to name your layer something that describes what it is. (I opted for *tracts*). Select lucasCo&#95;hungarian&#95;tracts.geojson dataset wherever you have it saved. Leave everything else as it is and click **Save &amp; Style**<br /><img src="https://maptastik.github.com/os-webmap-workshop/images/tm-map4.PNG" width=100% />
11. Alright! You've loaded in your data. You'll see some default cartoCSS for our tracts layers has been loaded into the style.mss pane on the right. Also note that in the bottom-left in the *Layers* window, we now have our tracts layer listed. You may initially not be able to the actual map of our tracts. In the *Layers* window, to the right of #tracts is a magnifying glass icon. Click that and the view will zoom to our tracts<br /><img src="https://maptastik.github.com/os-webmap-workshop/images/tm-map5.png" width=100% />
12. Let's take a look at the data? What are we going to map? In the *Layers* window, to the right of #tracts is a table icon. Click it and you should see the attribute table of the tracts data. We've got too attribute fields that were joined from ACS Census data. **t_hung** is total population in the tract claiming Hungarian ancestry. **p_hung** is the percentage of the population in the tract that claims Hungarian ancestry. Because we're making a choropleth map, it's best to use normalized data. We'll be working with the **p_hung** field for this map<br /><img src="https://maptastik.github.com/os-webmap-workshop/images/tm-map6.png" width=100% />
13. In the stylesheet pane, we have our default styling for our tracts layer:<br /><br />`#tracts {
  line-color:#594;
  line-width:0.5;
  polygon-opacity:1;
  polygon-fill:#ae8;
}`<br /><br />These style description give the map it's current look, but there are many properties of the polygon's fill and outline that can be edited. You can access the built-in CartoCSS reference by click the curly-brace button on that vertical stack of buttons mentioned earlier. Additionally, Mapbox includes the [reference](https://github.com/mapbox/carto/blob/master/docs/latest.md) on their GitHub page along with [several examples](https://www.mapbox.com/tilemill/docs/crashcourse/styling/) in the TileMill documentation on their website.<img src="https://maptastik.github.com/os-webmap-workshop/images/tm-ref1.png" width=100% />
14. Let's change some properties. Change:<br /><br />`line-color:#594;` to `line-color:#000000;`<br />and<br />`polygon-fill:#ae8;` to `polygon-fill:#2980b9;`.<br /><br />Click **Save**. If all is correct, you should have a map of census tracts in Lucas County, OH with a blue fill and black borders.<br /><img src="https://maptastik.github.com/os-webmap-workshop/images/tm-map7.png" width=100% />
15. Not too shabby! Way better than clicking through tons of dialog boxes. But this is a pretty boring map. Let's map those Hungarians! With CartoCSS we can assign styles to features that meet certain criteria. This is called conditional formatting. In this case we're going to apply conditional formatting to the fill of the tracts based on our **p_hung** field values.<br /><br />We're going to need to classify our **p_hung** field to create our choropleth map. TileMill is not a GIS and will not automatically create classification schemes based on your data. You'll have to do that in QGIS, ArcGIS, or by some other means. For the sake of this activity, I've created a classification scheme you can use. You may, of course, create your own. My scheme:<br>Class 1: <1<br>Class 2: 1-3.9<br>Class 3: 4-6.9<br>Class 4: 7-9.9<br>Class 5: >=10
16. We're almost ready to apply this classification scheme to the map. But first, it would be good to get a color scheme. Rather than make one up, let's use [ColorBrewer2](http://colorbrewer2.org/). You have a lot of freedom here to pick your colors, but make sure that under the *Nature of your data* you select **sequential**. This will help ensure that you select a color scheme appropriate for the data. Also, make sure to switch from HEX to and RGB colorspace. TileMill can handle both, but it handles transparency better with RGB. My scheme:<br>Class 1: 255,255,204<br>Class 2: 194,230,153<br>Class 3: 120,198,121<br>Class 4: 49,163,84<br>Class 5: 0,104,55<br><img src="https://maptastik.github.com/os-webmap-workshop/images/tm-cb1.png" width=100% />
17. Let's make this choropleth happen! Go ahead and just delete<br><br>`polygon-opacity:1;
    polygon-fill:#2980b9;`<br><br>We don't need them as they are.
18. We can now apply our conditional formatting. Let's try it by just applying fill to those tracts with less than 1% of the population claiming Hungarian ancestry. Underneath `line-width: 0.5` add:<br><br>`[p_hung<1] {polygon-fill: rgb(255,255,204);}`<br><br>Click **Save**. If there are no syntax errors, you should see that only a few census tracts have been filled in. The rest are transparent because they have no polygon-fill value at the moment. We'll change that next.<br><img src="https://maptastik.github.com/os-webmap-workshop/images/tm-map8.png" width=100% />
19. Let's add the rest of our classes with the appropriate colors following the model from the last step:<br><br>`[p_hung>=1] {polygon-fill: rgb(194,230,153);}`<br>`[p_hung>=4] {polygon-fill: rgb(120,198,121);}`<br>`[p_hung>=7] {polygon-fill: rgb(49,163,84);}`<br>`[p_hung>=10] {polygon-fill: rgb(0,104,55);}`<br><br>Click **Save**. If all went as planned and there are no errors, you should see a choropleth map based on the classification scheme defined earlier.<br><img src="https://maptastik.github.com/os-webmap-workshop/images/tm-map9.png" width=100% />
20. This is a pretty nice looking choropleth map, but there's no figure to ground relationship, no geographic context surrounding Lucas County. We could add additional state and county layers to create that context, but we can also place this choropleth map on top of a basemap. Although adding transparency to choropleth maps is a big no-no, in our enxt activity we'll be placing this map over a basemap well-suited for such a cartographic deviance.<br><br>To get that transparency in our polygon fill, we need to make a slight adjustment to our polygon-fill specifications. We can adjust transparency in RGB colors through the alpha channel, but at the moment our style doesn't address transparency. Our fill is fully opaque. To adjust that alpha channel is quite simple. Instead of `polygon-fill: rgb(...)` we need to use `polygon-fill: rgba(...)`. The **a** in rgba is our alpha channel and it allows us to add a fourth value in our color specification. We can select a number, 0 (totally transparent) - 1 (totally opaque), to adjust the opacity of the fill. Let's use 0.5. Your polygon fill formatting should look something like this:<br><br>`[p_hung<1] {polygon-fill: rgba(255,255,204,0.5);}
    [p_hung>=1] {polygon-fill: rgba(194,230,153,0.5);}
	[p_hung>=4] {polygon-fill: rgba(120,198,121,0.5);}
	[p_hung>=7] {polygon-fill: rgba(49,163,84,0.5);}
	[p_hung>=10] {polygon-fill: rgba(0,104,55,0.5);}`<br><br>Click **Save**<br><br><img src="https://maptastik.github.com/os-webmap-workshop/images/tm-map10.png" width=100% />
